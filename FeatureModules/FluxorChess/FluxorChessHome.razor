@using FluxorChess.Models
@inherits FluxorComponent

@inject IDispatcher Dispatcher
@inject IState<ChessState> State
@inject IMatDialogService MatDialogService

<div>
    <button class="btn btn-primary float-end" @onclick="NewGame">New Game</button>
    <BlazmGrid Data="Games" PageSize="20">
        <GridColumns>
            <GridColumn Field="@nameof(ChessGame.CreateBy)"></GridColumn>
            <GridColumn Field="@nameof(ChessGame.LastUpdateTimestamp)"></GridColumn>

        </GridColumns>
    </BlazmGrid>
</div>

@code{

    [CascadingParameter]
    public MatDialogReference DialogReference { get; set; }

    public List<ChessGame> Games { get; set; } = new();

    protected override void OnInitialized()
    {
        base.OnInitialized();
        SubscribeToAction<ChessSetStateAction>(payload => { Games = payload.Games; });
    }


    private async Task NewGame()
    {
        var result = await MatDialogService.PromptAsync("What is your name?");
        if (!string.IsNullOrWhiteSpace(result))
        {
            Dispatcher.Dispatch(new StartGameAction(result));
        }
    }

}